{% extends "base.html" %}

{% block title %}Trip Details - TravelPlanner{% endblock %}
{% block body_class %}trip-page{% endblock %}

{% block content %}
<section class="trip-details-container">
  <div class="trip-details-card">

    <header class="trip-details-header">
      <h2><i class="bi bi-geo-alt-fill"></i> {{ trip.destination }}</h2>
      <a href="{{ url_for('my_trips') }}" class="logout-btn">
        <i class="bi bi-arrow-left"></i> Back
      </a>
    </header>

    <div class="trip-banner">
      {% if trip.image %}
        <img src="{{ trip.image }}" alt="{{ trip.destination }}">
      {% else %}
        <img src="https://picsum.photos/seed/{{ trip.id }}/1200/400" alt="Trip Image">
      {% endif %}
    </div>

    <div class="trip-info-details">
      <h3>Trip Overview</h3>
      <p><i class="bi bi-calendar-event"></i> <strong>Start Date:</strong> {{ trip.start_date }}</p>
      <p><i class="bi bi-calendar-check"></i> <strong>End Date:</strong> {{ trip.end_date }}</p>
      <p><i class="bi bi-cash-coin"></i> <strong>Budget:</strong> ₹{{ trip.budget }}</p>
      <p><i class="bi bi-geo-alt-fill"></i> <strong>Destination:</strong> {{ trip.destination }}</p>
    </div>

    <div class="trip-notes">
      <h3><i class="bi bi-card-text"></i> Itinerary & Notes</h3>

      <div class="itinerary-box">
        <div class="itinerary-text">

          {% if trip.notes %}
            {% set cleaned = trip.notes
              | replace("**", "")
              | replace("•", "-")
              | replace("* ", "- ")
              | replace("*", "")
            %}

            {% for line in cleaned.split('\n') %}
              {% if line.strip().startswith('-') %}
                <ul>
                  <li>{{ line.replace('-', '').strip() }}</li>
                </ul>

              {% elif line.strip() %}
                {% if "Day" in line %}
                  <h4 class="day-heading" style="margin-top: 15px;">{{ line }}</h4>
                {% else %}
                  <p>{{ line }}</p>
                {% endif %}
              {% endif %}
            {% endfor %}

          {% else %}
            <p>No itinerary added.</p>
          {% endif %}

        </div>
      </div>

    </div>

    <div class="trip-actions">
      <a href="{{ url_for('edit_trip', id=trip.id) }}" class="auth-btn">
        <i class="bi bi-pencil-square"></i> Edit Trip
      </a>

      <form method="POST"
            action="{{ url_for('delete_trip', id=trip.id) }}"
            onsubmit="return confirm('Are you sure you want to delete this trip? This action cannot be undone.')">
        <button type="submit" class="auth-btn delete-btn">
          <i class="bi bi-trash-fill"></i> Delete Trip
        </button>
      </form>
    </div>

    <footer class="dashboard-footer">
      &copy; 2025 TravelPlanner. Adventure awaits ✈️
    </footer>

  </div>
</section>
{% endblock %}