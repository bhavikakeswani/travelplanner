{% extends "base.html" %}

{% block title %}Explore Destinations - TravelPlanner{% endblock %}
{% block body_class %}explore-page{% endblock %}

{% block content %}
  <div class="dashboard-container">
    <div class="dashboard-card">
      
      <div class="dashboard-header">
        <h2>Explore Destinations</h2>
        <a href="{{url_for('dashboard')}}" class="logout-btn">Back</a>
      </div>

      <div class="input-group" style="margin-bottom: 10px;">
        <i class="bi bi-search"></i>
        <input
          type="text"
          id="searchInput"
          placeholder="Search destinations..."
        >
      </div>

      <div class="trip-summary">
        <h3>Popular Places</h3>
        <div class="trip-cards">

          {% for d in destinations %}
          <a href="{{ url_for('itinerary', city=d.name, image=d.image) }}"
             class="trip-card-link destination-card"
             data-name="{{ d.name | lower }}">
            <div class="trip-card">
              <img src="{{ d.image }}" alt="{{ d.name }}">
              <div class="trip-info">
                <h4>{{ d.name }}</h4>
                <p>{{ d.desc }}</p>
              </div>
            </div>
          </a>
          {% endfor %}

        </div>
      </div>

      <div class="dashboard-actions">
        <a href="{{url_for('create_trip')}}" class="btn">Plan Your Trip</a>
      </div>

      <div class="dashboard-footer">
        Discover, dream & travel ✈️
      </div>

    </div>
  </div>
  
  <script>
    const searchInput = document.getElementById("searchInput");
    const cardsContainer = document.querySelector(".trip-cards");
    const originalCards = Array.from(document.querySelectorAll(".destination-card"));
    let dynamicCard = null;

    function createDynamicCard(city) {
      const formattedCity = city.charAt(0).toUpperCase() + city.slice(1);
      const a = document.createElement("a");
      a.href = `/itinerary/${encodeURIComponent(city)}`;
      a.className = "trip-card-link destination-card";
      a.dataset.name = city.toLowerCase();
      a.innerHTML = `
        <div class="trip-card">
          <img 
            src="https://picsum.photos/seed/${encodeURIComponent(city)}/600/400"
            alt="${formattedCity}"
            onerror="this.src='https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=600&q=80'"
          >
          <div class="trip-info">
            <h4>${formattedCity}</h4>
            <p>AI-generated itinerary available</p>
          </div>
        </div>
      `;
      return a;
    }

    searchInput.addEventListener("input", function () {
      const query = this.value.toLowerCase().trim();
      let matches = 0;

      if (dynamicCard) {
        dynamicCard.remove();
        dynamicCard = null;
      }

      originalCards.forEach(card => {
        const match = card.dataset.name.includes(query);
        card.style.display = match ? "block" : "none";
        if (match) matches++;
      });

      if (query && matches === 0) {
        dynamicCard = createDynamicCard(query);
        cardsContainer.prepend(dynamicCard);
      }
    });
  </script>
{% endblock %}