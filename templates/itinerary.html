{% extends "base.html" %}

{% block title %}{{ city }} Itinerary - TravelPlanner{% endblock %}
{% block body_class %}itinerary-page{% endblock %}

{% block content %}
  <div class="dashboard-container">
    <div class="dashboard-card">

      <div class="dashboard-header">
        <h2>{{ city }} Itinerary</h2>
        <a href="{{ url_for('explore') }}" class="logout-btn">Back</a>
      </div>

      <div class="trip-summary">
        <h3>Your AI-Generated Travel Plan</h3>

        <div class="itinerary-box">
          <div class="itinerary-text">
            {% if itinerary %}
              {% set clean_itinerary = itinerary
                | replace("**", "")
                | replace("â€¢", "-")
                | replace("* ", "- ")
              %}

              {% for line in clean_itinerary.split('\n') %}
                {% if line.strip().startswith('-') %}
                  <ul>
                    <li>{{ line.replace('-', '').strip() }}</li>
                  </ul>
                {% elif line.strip() %}
                  {% if "Day" in line %}
                    <h4 class="day-heading">{{ line }}</h4>
                  {% else %}
                    <p>{{ line }}</p>
                  {% endif %}
                {% endif %}
              {% endfor %}
            {% else %}
              <p class="error-text">Itinerary could not be generated. Please try again.</p>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="itinerary-actions">
        <form method="POST" action="{{ url_for('save_itinerary') }}">
          <input type="hidden" name="image" value="{{ image }}">
          <input type="hidden" name="destination" value="{{ city }}">
          <input type="hidden" name="notes" value="{{ itinerary | safe }}">
          <button type="submit" class="auth-btn">Add to My Trips</button>
        </form>
      </div>
    </div>
  </div>
{% endblock %}