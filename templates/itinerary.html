{% extends "base.html" %}

{% block title %}{{ city }} Itinerary - TravelPlanner{% endblock %}
{% block body_class %}itinerary-page{% endblock %}

{% block content %}
  <div class="dashboard-container">
    <div class="dashboard-card">

      <div class="dashboard-header">
        <h2>{{ city }} Itinerary</h2>
        <a href="{{ url_for('explore') }}" class="logout-btn">Back</a>
      </div>

      <div class="trip-summary">
        <h3>Your AI Travel Plan (Budget-Aware)</h3>

        {% if not itinerary %}
          <div class="itinerary-box">
            <form method="POST" class="itinerary-form" style="display: grid; gap: 12px;">

              <label>
                Start Date
                <input type="date" name="start_date" required>
              </label>

              <label>
                End Date
                <input type="date" name="end_date" required>
              </label>

              <label>
                Budget (₹)
                <input type="number" name="budget" min="0" step="0.01" required placeholder="e.g. 25000">
              </label>

              <button type="submit" class="auth-btn">Generate Itinerary</button>
            </form>
          </div>

        {% else %}
          <div class="itinerary-box">
            <div class="itinerary-text">
              {% set cleaned = itinerary
                 | replace("**", "")
                 | replace("•", "-")
                 | replace("* ", "- ")
                 | replace("*", "")
              %}

              {% for line in cleaned.split('\n') %}
                {% if line.strip().startswith('-') %}
                  <ul>
                    <li>{{ line.replace('-', '').strip() }}</li>
                  </ul>
                {% elif line.strip() %}
                  {% if "Day" in line %}
                    <h4 class="day-heading">{{ line }}</h4>
                  {% else %}
                    <p>{{ line }}</p>
                  {% endif %}
                {% endif %}
              {% endfor %}
            </div>
          </div>

          <div class="itinerary-actions">
            <form method="POST" action="{{ url_for('save_itinerary') }}" class="itinerary-form" style="display: grid; gap: 10px;">
              <input type="hidden" name="destination" value="{{ city }}">
              <input type="hidden" name="notes" value="{{ itinerary }}">
              <input type="hidden" name="start_date" value="{{ start_date }}">
              <input type="hidden" name="end_date" value="{{ end_date }}">
              <input type="hidden" name="budget" value="{{ budget }}">

              <button type="submit" class="auth-btn">Add to My Trips</button>
            </form>
          </div>
        {% endif %}
      </div>

    </div>
  </div>
{% endblock %}